# ä½¿ç”¨ SpringBoot å’Œ QueryDSL ç”Ÿæˆç”Ÿäº§çº§åŠ¨æ€è¿‡æ»¤å™¨

> åŸæ–‡ï¼š<https://medium.com/javarevisited/dynamic-query-predicate-generation-using-springboot-and-querydsl-fdb0d5d3555b?source=collection_archive---------0----------------------->

![](img/dfb9e1ebc583b53c91cff78c52680c0c.png)

ç”± [Austin Distel](https://unsplash.com/@austindistel?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

æˆ‘åŒå€¦äº†ä¸ºå‰ç«¯åº”ç”¨ç¨‹åºç¼–å†™å¤šä¸ª API ç«¯ç‚¹æ¥å‘ç”¨æˆ·æ˜¾ç¤ºè¿‡æ»¤åçš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘æƒ³å‡ºäº†ä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Spring Bootã€QueryDSL å’Œ [JPA](/javarevisited/5-best-spring-data-jpa-courses-for-java-developers-45e6438be3c9) ä¸ºä»»ä½•è¡¨å’Œä»»ä½•æ•°æ®åº“å·¥ä½œã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå‰ç«¯åªéœ€è¦è°ƒç”¨ä¸€ä¸ªç«¯ç‚¹ï¼Œå¹¶ä¼ å…¥åˆ—åã€æƒ³è¦å¯¹è¯¥åˆ—æ‰§è¡Œçš„æ“ä½œç±»å‹å’Œå€¼ã€‚

å®Œæ•´çš„å·¥ä½œä»£ç å¯ä»¥åœ¨æˆ‘çš„ [GitHub repo](https://github.com/Abhi-Codes/querydsl-dynamic-query) ä¸Šæ‰¾åˆ°ã€‚

# å±å›½

æ‚¨éœ€è¦å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° pom æ–‡ä»¶ä¸­ã€‚

# å®ä½“

[![](img/8c5024276badb0de339defcc220f5ece.png)](https://javarevisited.blogspot.com/2021/05/sql-and-database-phone-interview-questions.html)

ER å›¾

æœ‰ä¸€å¼ `Posts`è¡¨ã€‚ä¸€ä¸ªå¸–å­ä½¿ç”¨ä¸€å¯¹ä¸€æ˜ å°„ä¸ä¸€ä¸ª`Post Type` è¡¨ç›¸å…³è”ã€‚ä¸€ä¸ª`Post`ç”±ä½œè€…ç¼–å†™ï¼Œå¹¶ä½¿ç”¨å¤šå¯¹ä¸€æ˜ å°„ä¸`Users`è¡¨ç›¸å…³è”ã€‚å®ä½“æ˜ å°„å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/Abhi-Codes/querydsl-dynamic-query/tree/master/src/main/java/com/abhicodes/querydsldynamicquery/entity)æ‰¾åˆ°ã€‚ä¸€æ—¦åˆ›å»ºäº†å®ä½“ï¼Œè¿è¡Œ`mvn clean install`æ¥ç”Ÿæˆ Q ç±»ã€‚

# **å‚¨å­˜åº“**

`QueryDslPredicateExecutor`æ¥å£ä¸ºæˆ‘ä»¬çš„é›†åˆå…¬å¼€äº†ä¸€äº›éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚æˆ‘ä»¬ä»Šå¤©è¦å…³æ³¨çš„æ˜¯`Iterable<T> findAll(Predicate var1)`æ–¹æ³•ã€‚

æˆ‘ä»¬ä»Šå¤©çš„ä»£ç æœ¬è´¨ä¸Šå°†å½’ç»“ä¸ºå…è®¸æˆ‘ä»¬çš„ç”¨æˆ·åˆ›å»ºä¸€ä¸ª`Predicate`ï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥è‡ªå·±æœç´¢æ•´ä¸ªè¡¨ã€‚

# åˆ›å»ºè°“è¯

ç°åœ¨æˆ‘ä»¬æœ‰äº†è¿™ä¸ª[åº“](https://javarevisited.blogspot.com/2021/10/what-is-spring-data-repository.html)ï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦åšçš„å°±æ˜¯å…è®¸æˆ‘ä»¬çš„ç”¨æˆ·æ„å»ºä»–ä»¬è‡ªå·±çš„`Predicate`ç±»æ¥æœç´¢ä»–ä»¬æƒ³è¦çš„ä»»ä½•ä¸œè¥¿ã€‚

è¿™ä¸ªæƒ³æ³•å¯ä»¥å½’ç»“ä¸ºå…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå®šä¹‰ä»–ä»¬å¸Œæœ›åœ¨è¡¨ä¸Šæ‰§è¡Œçš„ä¸€ç³»åˆ—`AND`æ“ä½œã€‚æˆ‘ä»¬çš„å·¥ä½œæ˜¯è§£æè¿™ä¸ªæŸ¥è¯¢å¹¶ä¸ºå®ƒä»¬åˆ›å»º`[Predicate](https://javarevisited.blogspot.com/2021/05/java-8-stream-lambda-expression-d.html)`ã€‚ä»¥ä¸‹æ˜¯æŸ¥è¯¢çš„æ ¼å¼:

> **<é”®> <æ“ä½œç¬¦> <å€¼>ï¼Œ<é”®> <æ“ä½œç¬¦> <å€¼>**

**Key â€”** å®ƒåŸºæœ¬ä¸Šæ˜¯æ¥è‡ªå®ä½“ç±»çš„å­—æ®µåï¼Œå¯¹äºåµŒå¥—å­—æ®µï¼Œè¿™æ˜¯ä¸€ç§ç¨å¾®ä¸åŒçš„æ–¹æ³•ã€‚åœ¨ Post å®ä½“ä¸­ï¼Œæœ‰ä¸€ä¸ª`postType`å­—æ®µã€‚ä¸ºäº†åœ¨è°“è¯ä¸­ä½¿ç”¨`PostType`å®ä½“çš„`Id`å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦åœ¨è°“è¯ä¸­ä½¿ç”¨`postType.id`ï¼Œä½†æ˜¯ç‚¹ä¼šå½±å“æ¥è‡ªæ§åˆ¶å™¨çš„è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡åˆ›å»ºæ˜ å°„åˆ°`postType.id`çš„è‡ªå®šä¹‰é”®`postType`æ¥åˆ›å»ºè‡ªå®šä¹‰æ˜ å°„ã€‚

**æ“ä½œå‘˜â€”**

**å€¼â€”** å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ—¥æœŸã€æ•´æ•°æˆ–åŒç²¾åº¦ç±»å‹çš„ä»»ä½•å€¼ã€‚

> **ç”¨æ³•**

è¿‡æ»¤ä»¥æ˜¾ç¤ºåŒ…å«æ ‡é¢˜ **xyz â€”** `title-xyz`çš„åšå®¢

è¿‡æ»¤ä»¥æä¾›åŠ¨æœºåšå®¢â€” `postType:2`(åŠ¨æœºç±»å‹ id ä¸º 2)

è¿‡æ»¤ä»¥æ˜¾ç¤ºåœ¨ä¸¤ä¸ªæ—¥æœŸä¹‹é—´åˆ›å»ºçš„åšå®¢â€” `createdAt()2022â€“09â€“01,2022â€“09â€“10`

# **åˆ›å»ºæœç´¢æ ‡å‡†**

æˆ‘ä»¬å°†å¦‚ä¸‹å®šä¹‰å•ä¸ªæœç´¢æ ‡å‡†

# å…¬å…±è°“è¯ç±»

å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸Šé¢çš„ç±»ã€‚å¦‚æ‚¨æ‰€è§ï¼Œå®ƒæœ‰ä¸€ä¸ªæ–¹æ³•`getPredicate`ï¼Œè¯¥æ–¹æ³•å°†åŸºäºä¼ é€’çš„ SearchCriteria ç”Ÿæˆä¸€ä¸ªæ–°çš„`BooleanExpression`è°“è¯ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº† QueryDSL `Path`ç±»çš„å®ç°ã€‚è¿™äº›ç±»åŒ…å«å¯¹æ‚¨è¦æŸ¥è¯¢çš„å¯¹è±¡çš„å±æ€§çš„å¼•ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç»™å®ƒä»¬æ¯”è¾ƒè¿ç®—ç¬¦æ¥æ„å»ºä¸€ä¸ª`Predicate`ã€‚

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä½¿ç”¨åå°„æ¥ç¡®å®šè¢«ä¼ é€’çš„`Key`çš„ç±»ã€‚

ç»§ç»­ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦çš„æ˜¯å°†æ•´ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²è§£ææˆä¸€ä¸²`SearchCriteria`ï¼Œç„¶åä»æ•´ä¸ªæŸ¥è¯¢æ„å»ºä¸€ä¸ªç»„åˆè°“è¯ã€‚è¯¥ç±»å¯èƒ½å¦‚ä¸‹æ‰€ç¤º

ç›®å‰ï¼Œé‡è¦çš„æ–¹æ³•æ˜¯`from(String search)`æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä½¿ç”¨ regex ä»æŸ¥è¯¢å­—ç¬¦ä¸²åˆ›å»º SearchCriteriaã€‚ç„¶åæ„å»ºé‡‡ç”¨æ¯ä¸ªæ ‡å‡†ï¼Œä½¿ç”¨`CommonPredicate`åˆ›å»ºè°“è¯ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ä½œä¸º`AND`æ“ä½œï¼Œè¿”å›æœ€ç»ˆçš„è°“è¯ã€‚è¿™ä¸ªè°“è¯å¯ä»¥ç›´æ¥å‘é€åˆ°æˆ‘ä»¬çš„å­˜å‚¨åº“ï¼

# ä¸æœåŠ¡å’Œæ§åˆ¶å™¨ç±»æŒ‚é’©

æœåŠ¡ç±»æœ¬è´¨ä¸Šæ˜¯å°†è¿‡æ»¤å™¨æ ¼å¼åŒ–ä¸ºæœç´¢æ ‡å‡†ï¼Œä»è‡ªåŠ¨ç”Ÿæˆçš„è°“è¯ä¸­è·å– BooleanExpressionï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å­˜å‚¨åº“ã€‚

[æ§åˆ¶å™¨](https://javarevisited.blogspot.com/2022/05/how-to-return-json-xml-or-thymeleaf-.html)ç±»è·å–ä»å®¢æˆ·ç«¯ä¼ é€’æ¥çš„è¿‡æ»¤å™¨ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™æœåŠ¡ã€‚æ­£å¦‚æ‚¨åœ¨ä¸‹é¢çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’å¤šä¸ªæŸ¥è¯¢å‚æ•°æ¥æ„å»ºæŸ¥è¯¢ï¼Œå®¢æˆ·ç«¯éœ€è¦åœ¨è¯¥è¡¨åŠå…¶ç›¸å…³è¡¨ä¸Šè¿‡æ»¤è¯¥æŸ¥è¯¢ã€‚

[![](img/4b2c161e853ce2605a2fda52b2be6738.png)](https://javarevisited.blogspot.com/2022/02/spring-boot-restful-web-service-example-tutorial.html)

> å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·èŠ±ç‚¹æ—¶é—´ç»™æˆ‘é¼“æŒğŸ‘(å¯ä»¥å¤šæ¬¡é¼“æŒ)ï¼Œå…³æ³¨æˆ‘ï¼Œç”šè‡³ç»™æˆ‘ä¹°æ¯å’–å•¡[https://www.buymeacoffee.com/abhiandy](https://www.buymeacoffee.com/abhiandy)