<html>
<head>
<title>[Python] Build a todayâ€™s weather bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Python]å»ºé€ ä¸€ä¸ªä»Šå¤©çš„å¤©æ°”æœºå™¨äºº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/javarevisited/python-build-a-todays-weather-bot-15bf12ab6e8?source=collection_archive---------0-----------------------#2022-04-25">https://medium.com/javarevisited/python-build-a-todays-weather-bot-15bf12ab6e8?source=collection_archive---------0-----------------------#2022-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/12/10-free-python-courses-for-programmers.html"><div class="er es if"><img src="../Images/1e0878524f472508e78ef84431eba33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DfMlWYjpe3D3rgQm.png"/></div></a><p class="im in et er es io ip bd b be z dx translated">è¡Œé€šçŸ¥API</p></figure><p id="7832" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">LINEæ˜¯å°æ¹¾æœ€å—æ¬¢è¿çš„æ¶ˆæ¯åº”ç”¨ã€‚åœ¨è¿™äº›ç‰¹æ€§ä¸­ï¼Œå¸¦æœ‰æˆæƒä»¤ç‰Œçš„LINE Notify APIå…è®¸webåº”ç”¨ç¨‹åºæ‰‹åŠ¨æˆ–è‡ªåŠ¨å°†é€šçŸ¥ä¼ é€’ç»™ä¸ªäººå¸æˆ·æˆ–ç»„å¸æˆ·ã€‚</p><p id="ee53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">çº¿è·¯ä»¤ç‰Œ:<a class="ae jo" href="https://notify-bot.line.me/my/" rel="noopener ugc nofollow" target="_blank">https://notify-bot.line.me/my/</a></p><h1 id="d39a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">ç¬¬ä¸€æ­¥ã€‚é‚€è¯·çº¿è·¯é€šçŸ¥åˆ°ç»„</h1><p id="844c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">å¦‚æœæ‚¨æƒ³å°†ä¿¡æ¯å‘é€åˆ°çº¿è·¯ç¾¤ç»„è€Œä¸æ˜¯æ‚¨çš„ä¸ªäººå¸æˆ·ï¼Œè¯·è®°ä½åœ¨å‘é€ä¿¡æ¯ä¹‹å‰å°†çº¿è·¯é€šçŸ¥é‚€è¯·åˆ°ç¾¤ç»„ï¼Œä»¥ä¾¿ç¾¤ç»„å¯ä»¥é¦–å…ˆæ”¶åˆ°ä¿¡æ¯ã€‚</p><h1 id="96e8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">ç¬¬äºŒæ­¥ã€‚ç”Ÿæˆä»¤ç‰Œ</h1><p id="8438" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">åœ¨<a class="ae jo" href="https://notify-bot.line.me/my/" rel="noopener ugc nofollow" target="_blank">é¡µé¢</a>ç”Ÿæˆä»¤ç‰Œã€‚å½“æ‚¨ç‚¹å‡»<strong class="is hj">ç”Ÿæˆä»¤ç‰Œ</strong>ç„¶åçœ‹åˆ°ä»¤ç‰Œæ—¶ï¼Œè¯·å°†å…¶å¤åˆ¶åˆ°å®‰å…¨çš„åœ°æ–¹ï¼Œå› ä¸ºæ³¨æ„åˆ°<em class="ks">å¦‚æœæ‚¨ç¦»å¼€æ­¤é¡µé¢ï¼Œæ‚¨å°†æ— æ³•å†æ¬¡æŸ¥çœ‹æ‚¨æ–°ç”Ÿæˆçš„ä»¤ç‰Œã€‚è¯·åœ¨ç¦»å¼€æ­¤é¡µé¢å‰å¤åˆ¶ä»¤ç‰Œã€‚</em></p><figure class="ku kv kw kx fd ij er es paragraph-image"><a href="https://www.java67.com/2018/02/5-free-python-online-courses-for-beginners.html"><div class="er es kt"><img src="../Images/981a827b5d80672d5bcd47e18163f7c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVca6zSUPlkZUUYL4zFaAQ.png"/></div></a><p class="im in et er es io ip bd b be z dx translated">çº¿è·¯APIä»¤ç‰Œ</p></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6e2f" class="ld jq hi kz b fi le lf l lg lh">Note:<br/>Line Notify allow you to generate a token as the key to authorization. You can apply more than one token for variant purposes. Moreover, you can remove not used tokens.</span></pre><h1 id="5b71" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">ç¬¬ä¸‰æ­¥ã€‚è·å–å¤©æ°”APIå‡­æ®</h1><p id="269b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">æœ‰å¾ˆå¤šå…è´¹çš„å¼€æºå¤©æ°”APIã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨OpenWeatherï¼Œè¿™æ˜¯æœ€æµè¡Œçš„å¤©æ°”APIä¹‹ä¸€ã€‚å½“å‰å¤©æ°”çš„æ–‡æ¡£å¯ä»¥åœ¨<a class="ae jo" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>çœ‹åˆ°ã€‚</p><p id="c5df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è¦è·å¾—æ‚¨çš„APIå¯†é’¥ï¼Œæ‚¨åº”è¯¥ç‚¹å‡»â€œAPIå¯†é’¥â€å¹¶ä»<a class="ae jo" href="https://home.openweathermap.org/api_keys" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>å¤åˆ¶æ‚¨çš„APIå¯†é’¥ã€‚</p><h1 id="636b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">ç¬¬å››æ­¥ã€‚å¯†ç </h1><ol class=""><li id="b73f" class="li lj hi is b it kn ix ko jb lk jf ll jj lm jn ln lo lp lq bi translated">æ£€æŸ¥<a class="ae jo" rel="noopener" href="/javarevisited/7-best-courses-to-learn-postman-tool-for-web-service-and-api-testing-f225c138fa5a"> API </a>æ˜¯å¦å·¥ä½œã€‚æˆ‘æ›´ä¹ æƒ¯äºçœ‹åˆ°æ‘„æ°æ¸©åº¦ï¼Œæ‰€ä»¥æˆ‘å°†APIè°ƒç”¨çš„å‚æ•°æ›¿æ¢ä¸ºä¸‹é¢çš„<code class="du lr ls lt kz b">unit=metric</code>ã€‚</li></ol><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="f677" class="ld jq hi kz b fi le lf l lg lh">import requests</span><span id="1110" class="ld jq hi kz b fi lu lf l lg lh">import json</span><span id="5104" class="ld jq hi kz b fi lu lf l lg lh">apiKey = "Your API key from step 3"<br/>lineToken = "Your token got from step 2"</span><span id="e2c8" class="ld jq hi kz b fi lu lf l lg lh"># id = city ID</span><span id="2b21" class="ld jq hi kz b fi lu lf l lg lh">url = "https://api.openweathermap.org/data/2.5/weather?id=1668338&amp;units=metric&amp;appid=" + key</span><span id="28a3" class="ld jq hi kz b fi lu lf l lg lh">r = requests.get(url)<br/>data = json.loads(r.text)</span><span id="c016" class="ld jq hi kz b fi lu lf l lg lh">print(data)</span></pre><p id="3c6f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ç»“æœå°†ç±»ä¼¼äºä¸‹å›¾ï¼Œ<code class="du lr ls lt kz b">status=200</code>è¡¨ç¤ºæˆåŠŸè·å–æ•°æ®:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="5bc0" class="ld jq hi kz b fi le lf l lg lh">{'coord': {'lon': 121.6503, 'lat': 25.0486}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'base': 'stations', 'main': {'temp': 25.9, 'feels_like': 26.37, 'temp_min': 25.33, 'temp_max': 27.26, 'pressure': 1011, 'humidity': 70}, 'visibility': 9000, 'wind': {'speed': 3.09, 'deg': 100}, 'clouds': {'all': 75}, 'dt': 1650885341, 'sys': {'type': 2, 'id': 2032887, 'country': 'TW', 'sunrise': 1650835355, 'sunset': 1650881998}, 'timezone': 28800, 'id': 1668338, 'name': 'Taipei City', 'cod': 200}<br/>{"status":200,"message":"ok"}</span></pre><p id="81ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.å› ä¸ºæˆ‘åªéœ€è¦ä¸‹é¢æ¶ˆæ¯ä¸­çš„åŸå¸‚ã€å½“å‰æ¸©åº¦ã€æœ€é«˜æ¸©åº¦ã€æœ€ä½æ¸©åº¦å’Œå¤©æ°”æè¿°çš„æ•°æ®ï¼Œæ‰€ä»¥å¤„ç†<a class="ae jo" href="https://www.java67.com/2016/10/3-ways-to-convert-string-to-json-object-in-java.html" rel="noopener ugc nofollow" target="_blank"> JSONæ•°æ®</a>å°±æ˜¯ä¸ºäº†è¿™ä¸ªç›®çš„ã€‚</p><figure class="ku kv kw kx fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/02/how-to-parse-json-with-date-field-in-java-jackson-example.html"><div class="er es lv"><img src="../Images/41e2a19070ee1e6973a1e17af4bfff12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FST34F4izEu7oqjfbG6UUg.png"/></div></a></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="5f7e" class="ld jq hi kz b fi le lf l lg lh">"""<br/># if units=imperial and it should be converted to metric additionally:</span><span id="055e" class="ld jq hi kz b fi lu lf l lg lh">def tempToC(fTemp):<br/>return round((fTemp - 32) * 5 / 9, 1)<br/>temp = data["main"]["temp"])<br/>temp_max = tempToC(data["main"]["temp_max"])<br/>temp_min = tempToC(data["main"]["temp_min"])<br/>"""</span><span id="7b3a" class="ld jq hi kz b fi lu lf l lg lh">temp = data["main"]["temp"]<br/>temp_max = data["main"]["temp_max"]<br/>temp_min = data["main"]["temp_min"]<br/>weather = data["weather"][0]["description"].capitalize()</span></pre><p id="0656" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.æˆ‘å°†é€šè¿‡å¤©æ°”æœºå™¨äººå‘é€çš„æ¶ˆæ¯ç”±ä»¥ä¸‹å­—ç¬¦ä¸²ç»„æˆ:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="e613" class="ld jq hi kz b fi le lf l lg lh">msg = "%s\n ğŸŒ¡Current temperature: %sÂ°C\n ğŸ’ŒHighest temperature: %s\n ğŸ’ŒLowest temperature: %s\n ğŸ’§%s" %(data['name'],temp,temp_max,temp_min,weather)</span></pre><p id="7f3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨LINE notify APIå‘é€HTTPè¯·æ±‚æ¥å‘é€æ¶ˆæ¯:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="d0de" class="ld jq hi kz b fi le lf l lg lh">url = "https://notify-api.line.me/api/notify"<br/>payload = {"message": {msg}}<br/>headers = {"Authorization": "Bearer " + lineToken}<br/>response = requests.request("POST", url, headers=headers, data=payload)<br/>print(response.text)</span></pre><p id="2379" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.ä½¿ç”¨<code class="du lr ls lt kz b">schedule</code>æ¨¡å—ä½¿ä»£ç åœ¨æ¯å¤©æ—©ä¸Š7:30ä¾‹è¡Œè¿è¡Œ:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="211e" class="ld jq hi kz b fi le lf l lg lh">import schedule<br/>import time</span><span id="95cc" class="ld jq hi kz b fi lu lf l lg lh">schedule.every().day.at("07:30").do(sendToLine(lineToken,msg))<br/>schedule.every(10).seconds.do(sendToLine, (lineToken))</span><span id="6409" class="ld jq hi kz b fi lu lf l lg lh">while True:<br/>     schedule.run_pending()<br/>     time.sleep(1)</span></pre><p id="8e05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ç§å•Šã€‚ï¼æå®šäº†ã€‚ï¼ğŸ‰</p></div></div>    
</body>
</html>